```sql
-- ===============================================
-- MIGRAZIONE E MANUTENZIONE
-- ===============================================

-- Aggiornamento di massa della struttura JSON
UPDATE users 
SET preferences = preferences || '{"version": "2.0"}'::jsonb
WHERE NOT preferences ? 'version';

-- Cleanup di campi non utilizzati
UPDATE products 
SET specifications = specifications - 'deprecated_field'
WHERE specifications ? 'deprecated_field';

-- Query per analizzare la struttura JSON esistente
SELECT DISTINCT jsonb_object_keys(preferences) as preference_keys
FROM users;

-- Controllo integritÃ  dati JSON
SELECT name, preferences
FROM users 
WHERE NOT jsonb_typeof(preferences->'notifications') = 'object';
```