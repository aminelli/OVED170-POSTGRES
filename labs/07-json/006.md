```sql
-- ===============================================
-- AGGREGAZIONI CON JSON
-- ===============================================

-- Aggregare dati in JSON
SELECT 
    jsonb_agg(
        jsonb_build_object(
            'name', name,
            'city', profile->>'city',
            'age', profile->>'age'
        )
    ) as users_summary
FROM users;

-- Raggruppare e aggregare
SELECT 
    profile->>'city' as city,
    jsonb_agg(name) as residents
FROM users 
GROUP BY profile->>'city';

```